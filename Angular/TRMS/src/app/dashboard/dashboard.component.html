<!-- login component -->
<div *ngIf="display == 'login'" class="centerCenter">
  <Form
    class="formBox"
    autocomplete="off"
    ngForm
    #fl="ngForm"
    (ngSubmit)="submit(fl)"
  >
    <h2>Log into TRMS</h2>
    <div class="formElement">
      <input
        ngModel
        #username="ngModel"
        required
        type="text"
        name="username"
        placeholder="Username"
      />
      <div *ngIf="username.touched && username.invalid" class="alert">
        <div *ngIf="username.errors.required">This field is required</div>
      </div>
    </div>

    <div class="formElement">
      <input
        ngModel
        #password="ngModel"
        required
        type="password"
        name="password"
        placeholder="Password"
      />
      <div *ngIf="password.touched && password.invalid" class="alert">
        <div *ngIf="password.errors.required">This field is required</div>
      </div>
    </div>
    <div class="formElement">
      <input type="submit" [disabled]="!fl.valid" value="Log in" />
    </div>
  </Form>
</div>
<!-- dashboard component -->
<div *ngIf="display != 'login'" class="dashboardBox">
  <h3>Tuition Reimbursement Management System</h3>
  <div class="header row">
    <div class="col">
      <h4>Welcome {{ user.firstName }}</h4>
      <a (click)="displayChange('forms')">My Forms</a>
      <a (click)="displayChange('newForm')">New Form</a>
      <a
        *ngIf="user.title != 'Associate' || user.department == 'Benefits'"
        (click)="displayChange('manage')"
        >Manage</a
      >
      <a (click)="displayChange('login')">Log out</a>
    </div>
    <div class="infoBox col">
      <p>available amount ${{ availableReinbursement }}</p>
    </div>
  </div>
  <hr />
  <!-- myforms -->
  <div *ngIf="display == 'forms'" class="row">
    <ul class="col">
      <h4 class="listTitle">list for submitted forms</h4>
      <li *ngIf="!forms">No messages</li>
      <li *ngFor="let item of forms">
        <div class="btnBox">
          <button (click)="focusOn(item)">View</button>
          {{ item.formSubDate.substr(5, 5) }}
        </div>
        <div class="msgBox">ID: {{ item.id }}, Status: {{ item.status }}</div>
      </li>
    </ul>
    <ul class="col">
      <h4 class="listTitle">list for messages</h4>
      <li *ngIf="!messages">No messages</li>
      <li *ngFor="let item of messages">
        <div class="btnBox">
          <button (click)="remove(item)">X</button>
          {{ item.submittedOn.substr(5, 5) }}
        </div>
        <div class="msgBox">{{ item.message }}</div>
      </li>
    </ul>
  </div>
  <!-- manageForms -->
  <div *ngIf="display == 'manage'" class="row">
    <ul class="col">
      <h4 class="listTitle">list for submitted forms</h4>
      <li *ngIf="!manageForms">No forms to review</li>
      <li *ngFor="let item of manageForms">
        <div class="btnBox">
          <button (click)="focusOn(item)">View</button>
        </div>
        <div class="msgBox">
          FormID: {{ item.id }} Status: {{ item.status }}
        </div>
      </li>
    </ul>
    <ul class="col"></ul>
  </div>
  <!-- focus form -->
  <div *ngIf="display == 'focus'">
    <div class="centerCenter">
      <div class="formBox">
        <h2>Tuition Reimbursement Form</h2>
        <div
          style="text-align: center; color: red;"
          *ngIf="focus.isUrgent && focus.empID != user.id"
        >
          This is Urgent
        </div>
        <div class="formElement">
          <p>
            Employee ID: <span>{{ focusEmployee.id }}</span>
          </p>
        </div>
        <div class="formElement">
          <p>
            First name: <span>{{ focusEmployee.firstName }}</span>
          </p>
        </div>
        <div class="formElement">
          <p>
            Last name: <span>{{ focusEmployee.lastName }}</span>
          </p>
        </div>

        <div class="row">
          <div class="formElement">
            <label for="startDate">Start date </label> <br />
            <input disabled [value]="focus.startDate" />
          </div>

          <div class="formElement">
            <label for="startTime">Start time </label> <br />
            <input disabled [value]="focus.startTime" />
          </div>
        </div>

        <div class="formElement">
          <label for="location">Location </label> <br />
          <input disabled [value]="focus.location" />
        </div>

        <div class="row">
          <div class="formElement">
            <label for="cost">Event cost </label> <br />
            <input disabled [value]="focus.cost" />
          </div>
          <div class="formElement">
            <label for="return">Estimated return</label> <br />
            <input disabled [value]="focus.pendingRe" />
          </div>
        </div>

        <div class="row">
          <div class="formElement col">
            <label for="gradingFormat">Grading Format </label> <br />
            <input
              disabled
              [value]="gradingFormat(focus.gradeFormatID)"
              type="text"
            />
          </div>

          <div class="formElement col">
            <label for="eventType">Event type </label> <br />
            <input disabled [value]="focus.eventType" type="text" />
          </div>
        </div>

        <div class="formElement">
          <label for="description">Description </label> <br />
          <textarea
            disabled
            [placeholder]="focus.description"
            cols="30"
            rows="5"
          ></textarea>
        </div>

        <div class="formElement">
          <label for="justification"
            >Work related justification
            <textarea
              disabled
              [placeholder]="focus.justification"
              cols="30"
              rows="5"
            ></textarea>
          </label>
        </div>
        <!--If Grades are submitted-->
        <div *ngIf="focus.finalGrade" class="formElement">
          Final Grade is {{ focus.finalGrade }}%
        </div>
        <div *ngIf="focus.finalPres" class="formElement">
          <a [href]="focus.finalPres">Final Presentation</a>
        </div>
        <!--If Pending Starts Here-->
        <div *ngIf="focus.status == 'Pending'">
          <div *ngIf="user.id != focus.empID">
            <div
              *ngIf="focus.finalGrade && focus.gradeApr == 'False'"
              class="formElement"
            >
              <div class="buttonBox">
                <button (click)="onReviewChanges('Confirm', 'Grade')">
                  Confirm
                </button>
                <button (click)="onReviewChanges('Deny', 'Grade')">
                  Deny
                </button>
              </div>
            </div>
            <div
              *ngIf="focus.finalPres && focus.presApr == 'False'"
              class="formElement"
            >
              <div class="buttonBox">
                <button (click)="onReviewChanges('Confirm', 'Pres')">
                  Confirm
                </button>
                <button (click)="onReviewChanges('Deny', 'Pres')">
                  Deny
                </button>
              </div>
            </div>
          </div>
          <div *ngIf="user.id == focus.empID">
            <form
              #fv="ngForm"
              *ngIf="!alreadySubmitted"
              (ngSubmit)="finalGradePost(fv)"
            >
              <div class="formElement row">
                <div class="col">
                  <input
                    (click)="finalType = 'grade'"
                    required
                    class="radioBtn"
                    type="radio"
                    name="finalType"
                    id="grade"
                    value="grade"
                  /><label for="grade">Submit Grade</label>
                </div>
                <div class="col">
                  <input
                    (click)="finalType = 'presentation'"
                    class="radioBtn"
                    type="radio"
                    name="finalType"
                    id="presentation"
                    value="presentation"
                  /><label for="presentation">Submit Presentation</label>
                </div>
              </div>

              <div *ngIf="finalType == 'grade'" class="formElement">
                <label for="finalGrade">
                  <input
                    ngModel
                    required
                    #finalGrade="ngModel"
                    placeholder="Enter your final grade"
                    type="number"
                    name="finalGrade"
                    id="finalGrade"
                  />
                </label>
              </div>

              <div *ngIf="finalType == 'presentation'" class="formElement">
                <div id="optionalInfo">
                  <label for="finalPres">
                    Attach final presentation
                    <input
                      ngModel
                      required
                      #finalPres="ngModel"
                      type="file"
                      name="finalPres"
                      id="finalPres"
                    />
                  </label>
                </div>
              </div>
              <div class="formElement">
                <input
                  [disabled]="alreadySubmitted"
                  type="submit"
                  value="Submit Final Grage/Presentation"
                />
              </div>
            </form>
          </div>
        </div>
        <!--If Not Pending Starts Here-->
        <div *ngIf="focus.status != 'Pending'">
          <div *ngIf="user.id != focus.empID">
            <div class="buttonBox">
              <button (click)="onReviewChanges('Approved')">Approve</button>
              <button (click)="declineReason = !declineReason">Decline</button>
            </div>

            <div style="text-align: center;" class="formElement">
              <button (click)="requestAdditional = !requestAdditional">
                Request additinoal information
              </button>
              <form
                ngForm
                #fa="ngForm"
                (ngSubmit)="sendMessage(fa)"
                *ngIf="requestAdditional"
              >
                <!--TODO: make from employee a select with varOptions -->
                <div class="formElement">
                  <label for="requestMessage"
                    >From employee #{{ focus.empID }}
                    <textarea
                      ngModel
                      required
                      name="requestMessage"
                      id="requestMessage"
                      #requestMessage="ngModel"
                      placeholder="ex. I need more information please."
                      cols="30"
                      rows="5"
                    ></textarea>
                  </label>
                </div>

                <div class="formElement">
                  <label for="requestSubmit">
                    <input
                      name="requestSubmit"
                      id="requestSubmit"
                      type="submit"
                      [disabled]="!fa.valid"
                      value="Submit"
                    />
                  </label>
                </div>
              </form>
            </div>
            <div style="text-align: center;" class="formElement">
              <form
                ngForm
                #fd="ngForm"
                (ngSubmit)="onReviewChanges('Declined', fd.value.declineReason)"
                *ngIf="declineReason"
              >
                <div class="formElement">
                  <label for="declineReason"
                    >to employee #{{ focus.empID }}
                    <textarea
                      ngModel
                      required
                      name="declineReason"
                      id="declineReason"
                      #declineReason="ngModel"
                      placeholder="ex. Not valid material."
                      cols="30"
                      rows="5"
                    ></textarea>
                  </label>
                </div>

                <div class="formElement">
                  <label for="declineSubmit">
                    <input
                      name="declineSubmit"
                      id="declineSubmit"
                      type="submit"
                      [disabled]="!fd.valid"
                      value="Submit"
                    />
                  </label>
                </div>
              </form>
            </div>
          </div>

          <div style="text-align: center;" class="formElement">
            <button
              *ngIf="
                this.user.department == 'Benefits' &&
                this.focus.isAltered == 'False'
              "
              (click)="alterForm = !alterForm"
            >
              Override Return Amount
            </button>
            <form
              ngForm
              #fAlter="ngForm"
              (ngSubmit)="
                onReviewChanges('Alternative', fAlter.value.suggestAlter)
              "
              *ngIf="alterForm"
            >
              <div class="formElement">
                <label for="suggestAlter"
                  >to employee #{{ focus.empID }}
                  <input
                    ngModel
                    required
                    name="suggestAlter"
                    id="suggestAlter"
                    #suggestAlter="ngModel"
                    type="number"
                    [placeholder]="focus.pendingRe"
                  />
                </label>
              </div>

              <div class="formElement">
                <label for="suggestSubmit">
                  <input
                    name="suggestSubmit"
                    id="suggestSubmit"
                    type="submit"
                    [disabled]="!fAlter.valid"
                    value="Submit"
                  />
                </label>
              </div>
            </form>
          </div>

          <div *ngIf="user.id == focus.empID">
            <div *ngIf="user"></div>

            <div class="formElement alert" *ngIf="focus.isAltered == 'True'">
              This form has been reviewed and altered by the Benefit
              Coordinator. Keep the changes?
              <div class="buttonBox">
                <button (click)="onReviewChanges('Accept')">Accept</button
                ><button (click)="onReviewChanges('Canceled')">Decline</button>
              </div>
            </div>
            <div *ngIf="focus.isAltered != 'True'">
              <div style="text-align: center;" *ngIf="alreadySubmitted">
                Final submitted and awaiting review
              </div>
            </div>
          </div>
        </div>
        <!--If Not Pending Ends Here-->
      </div>
    </div>
  </div>
  <!-- mew form -->
  <r-form [setDate]="setDate" *ngIf="display == 'newForm'" [user]="user">
  </r-form>
</div>
